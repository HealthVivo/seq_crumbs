#!/usr/bin/env python

# Copyright 2012 Jose Blanca, Peio Ziarsolo, COMAV-Univ. Politecnica Valencia
# This file is part of seq_crumbs.
# seq_crumbs is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.

# seq_crumbs is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR  PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with seq_crumbs. If not, see <http://www.gnu.org/licenses/>.

import sys
import os.path
import argparse

from crumbs.utils import main
from crumbs.exceptions import FileNotFoundError
from crumbs.seqio import guess_format


def _setup_argparse():
    'It prepares the command line argument parsing.'
    description = 'It guesses the format of the sequence input file.'
    epilog = 'This program ignores the possibility of the old solexa fastq '
    epilog += 'format'
    parser = argparse.ArgumentParser(description=description, epilog=epilog)
    parser.add_argument('input', help="Sequence input file to process")

    return parser


def _parse_args(parser):
    '''It parses the command line and it returns a dict with the arguments.'''
    parsed_args = parser.parse_args()
    in_fpath = parsed_args.input
    if os.path.exists(in_fpath):
        in_fhand = open(in_fpath, 'rb')
    else:
        raise FileNotFoundError('The file was not found: ' + in_fpath)
    args = {'in_fhand': in_fhand}
    return args


def guess_seq_format():
    'It guesses the file format of a file'

    parser = _setup_argparse()
    args = _parse_args(parser)

    fmt = guess_format(args['in_fhand'])
    sys.stdout.write(fmt + '\n')

if __name__ == '__main__':
    sys.exit(main(guess_seq_format))
